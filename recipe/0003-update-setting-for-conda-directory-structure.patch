From 1b3ee65cc1e210b30f897ff1f9334d38dc2b1a03 Mon Sep 17 00:00:00 2001
From: Jeremy Volkening <jdvolkening@gmail.com>
Date: Thu, 22 Feb 2024 20:21:31 -0600
Subject: [PATCH] set windows configuration

---
 win32/GNUmakefile |  18 ++++--
 win32/config.gc   | 154 +++++++++++++++++++++++-----------------------
 2 files changed, 90 insertions(+), 82 deletions(-)

diff --git a/win32/GNUmakefile b/win32/GNUmakefile
index b944a5a..93f230b 100644
--- a/win32/GNUmakefile
+++ b/win32/GNUmakefile
@@ -147,7 +147,7 @@ USE_LARGE_FILES	:= define
 # Comment this out if you want the legacy default behavior of including '.' at
 # the end of @INC.
 #
-DEFAULT_INC_EXCLUDES_DOT := define
+#DEFAULT_INC_EXCLUDES_DOT := define
 
 #
 # Uncomment this if you want to disable looking up values from
@@ -287,7 +287,7 @@ EXTRALIBDIRS	:=
 # set this to your email address (perl will guess a value from
 # your loginname and your hostname, which may not be right)
 #
-#EMAIL		:=
+EMAIL		:= conda
 
 ##
 ## Build configuration ends.
@@ -538,7 +538,7 @@ HTMLDIR		= .\html
 
 INST_SCRIPT	= $(INST_TOP)$(INST_VER)\bin
 INST_BIN	= $(INST_SCRIPT)$(INST_ARCH)
-INST_LIB	= $(INST_TOP)$(INST_VER)\lib
+INST_LIB	= $(INST_TOP)$(INST_VER)\lib\perl5\core_perl
 INST_ARCHLIB	= $(INST_LIB)$(INST_ARCH)
 INST_COREDIR	= $(INST_ARCHLIB)\CORE
 INST_HTML	= $(INST_TOP)$(INST_VER)\html
@@ -623,6 +623,7 @@ BUILDOPT	+= -fno-strict-aliasing -mms-bitfields
 MINIBUILDOPT	+= -fno-strict-aliasing
 
 TESTPREPGCC	= test-prep-gcc
+BINDLLGCC      = bin-dll-gcc
 
 else
 
@@ -837,6 +838,7 @@ EXEOUT_FLAG	= -Fe
 LIBOUT_FLAG	= /out:
 PDBOUT		= -Fd$(*).pdb
 TESTPREPGCC	=
+BINDLLGCC	=
 
 endif
 
@@ -1189,6 +1191,7 @@ DYNALOADER	= ..\DynaLoader$(o)
 CFG_VARS	=					\
 		"INST_TOP=$(INST_TOP)"			\
 		"INST_VER=$(INST_VER)"			\
+		"PKG_VERS=$(PKG_VERS)"			\
 		"INST_ARCH=$(INST_ARCH)"		\
 		"archname=$(ARCHNAME)"			\
 		"cc=$(CC)"				\
@@ -1874,7 +1877,7 @@ distclean: realclean
 	-if exist $(HTMLDIR) rmdir /s /q $(HTMLDIR)
 	-del /f ..\t\test_state
 
-install : all installbare installhtml
+install : all installbare $(BINDLLGCC)
 
 installbare : utils ..\pod\perltoc.pod
 	$(PERLEXE) ..\installperl
@@ -1924,6 +1927,13 @@ test-prep-gcc :
 	if exist $(CCDLLDIR)\libstdc++-6.dll $(XCOPY) $(CCDLLDIR)\libstdc++-6.dll ..\t\$(NULL)
 	if exist $(CCDLLDIR)\libwinpthread-1.dll $(XCOPY) $(CCDLLDIR)\libwinpthread-1.dll ..\t\$(NULL)
 
+bin-dll-gcc :
+	if exist $(CCDLLDIR)\libgcc_s_seh-1.dll $(XCOPY) $(CCDLLDIR)\libgcc_s_seh-1.dll $(INST_BIN)\$(NULL)
+	if exist $(CCDLLDIR)\libgcc_s_sjlj-1.dll $(XCOPY) $(CCDLLDIR)\libgcc_s_sjlj-1.dll $(INST_BIN)\$(NULL)
+	if exist $(CCDLLDIR)\libgcc_s_dw2-1.dll $(XCOPY) $(CCDLLDIR)\libgcc_s_dw2-1.dll $(INST_BIN)\$(NULL)
+	if exist $(CCDLLDIR)\libstdc++-6.dll $(XCOPY) $(CCDLLDIR)\libstdc++-6.dll $(INST_BIN)\$(NULL)
+	if exist $(CCDLLDIR)\libwinpthread-1.dll $(XCOPY) $(CCDLLDIR)\libwinpthread-1.dll $(INST_BIN)\$(NULL)
+
 endif
 
 test : test-prep
diff --git a/win32/config.gc b/win32/config.gc
index 793b455..c8918f7 100644
--- a/win32/config.gc
+++ b/win32/config.gc
@@ -22,8 +22,8 @@ api_subversion='~PERL_API_SUBVERSION~'
 api_version='~PERL_API_VERSION~'
 api_versionstring='~PERL_API_REVISION~.~PERL_API_VERSION~.~PERL_API_SUBVERSION~'
 ar='~ARCHPREFIX~ar'
-archlib='~INST_TOP~~INST_VER~\lib~INST_ARCH~'
-archlibexp='~INST_TOP~~INST_VER~\lib~INST_ARCH~'
+archlib='~INST_TOP~/lib/perl5/~PKG_VERS~/core_perl'
+archlibexp='~INST_TOP~/lib/perl5/~PKG_VERS~/core_perl'
 archname64=''
 archname='MSWin32'
 archobjs=''
@@ -31,8 +31,8 @@ asctime_r_proto='0'
 awk='awk'
 baserev='5'
 bash=''
-bin='~INST_TOP~~INST_VER~\bin~INST_ARCH~'
-binexp='~INST_TOP~~INST_VER~\bin~INST_ARCH~'
+bin='~INST_TOP~/bin'
+binexp='~INST_TOP~/bin'
 bison=''
 bootstrap_charset='undef'
 byacc='byacc'
@@ -48,8 +48,8 @@ ccflags_uselargefiles=''
 ccname='~cc~'
 ccsymbols=''
 ccversion=''
-cf_by='nobody'
-cf_email='nobody@no.where.net'
+cf_by='conda'
+cf_email='conda'
 cf_time=''
 charbits='8'
 chgrp=''
@@ -351,7 +351,7 @@ d_long_double_style_ieee_doubledouble='undef'
 d_long_double_style_ieee_extended='define'
 d_long_double_style_ieee_std='undef'
 d_long_double_style_vax='undef'
-d_longdbl='define'
+d_longdbl='undef'
 d_longlong='define'
 d_lrint='define'
 d_lrintl='define'
@@ -416,7 +416,7 @@ d_open3='undef'
 d_openat='undef'
 d_pathconf='undef'
 d_pause='define'
-d_perl_otherlibdirs='undef'
+d_perl_otherlibdirs='define'
 d_phostname='undef'
 d_pipe2='undef'
 d_pipe='define'
@@ -609,10 +609,10 @@ d_uselocale='undef'
 d_usleep='undef'
 d_usleepproto='undef'
 d_ustat='undef'
-d_vendorarch='undef'
-d_vendorbin='undef'
-d_vendorlib='undef'
-d_vendorscript='undef'
+d_vendorarch='define'
+d_vendorbin='define'
+d_vendorlib='define'
+d_vendorscript='define'
 d_vfork='undef'
 d_void_closedir='undef'
 d_voidsig='define'
@@ -815,37 +815,35 @@ inc_version_list=''
 inc_version_list_init='0'
 incpath=''
 inews=''
-initialinstalllocation=''
-installarchlib='~INST_TOP~~INST_VER~\lib~INST_ARCH~'
-installbin='~INST_TOP~~INST_VER~\bin~INST_ARCH~'
+initialinstalllocation='~INST_TOP~/bin'
+installarchlib='~INST_TOP~/lib/perl5/~PKG_VERS~/core_perl'
+installbin='~INST_TOP~/bin'
 installhtml1dir=''
 installhtml3dir=''
-installhtmldir='~INST_TOP~~INST_VER~\html'
-installhtmlhelpdir='~INST_TOP~~INST_VER~\htmlhelp'
-installman1dir='~INST_TOP~~INST_VER~\man\man1'
-installman3dir='~INST_TOP~~INST_VER~\man\man3'
-installprefix='~INST_TOP~~INST_VER~'
-installprefixexp='~INST_TOP~~INST_VER~'
-installprivlib='~INST_TOP~~INST_VER~\lib'
-installscript='~INST_TOP~~INST_VER~\bin'
-installsitearch='~INST_TOP~\site~INST_VER~\lib~INST_ARCH~'
-installsitebin='~INST_TOP~~INST_VER~\bin~INST_ARCH~'
+installman1dir='~INST_TOP~/man/man1'
+installman3dir='~INST_TOP~/man/man3'
+installprefix='~INST_TOP~'
+installprefixexp='~INST_TOP~'
+installprivlib='~INST_TOP~/lib/perl5/core_perl'
+installscript='~INST_TOP~/bin'
+installsitearch='~INST_TOP~/lib/perl5/~PKG_VERS~/site_perl'
+installsitebin='~INST_TOP~/bin'
 installsitehtml1dir=''
 installsitehtml3dir=''
-installsitelib='~INST_TOP~\site~INST_VER~\lib'
-installsiteman1dir=''
-installsiteman3dir=''
-installsitescript=''
-installstyle='lib'
+installsitelib='~INST_TOP~/lib/perl5/site_perl'
+installsiteman1dir='~INST_TOP~/man/man1'
+installsiteman3dir='~INST_TOP~/man/man3'
+installsitescript='~INST_TOP~/bin'
+installstyle='lib/perl5'
 installusrbinperl='undef'
-installvendorarch=''
-installvendorbin=''
+installvendorarch='~INST_TOP~/lib/perl5/~PKG_VERS~/vendor_perl'
+installvendorbin='~INST_TOP~/bin'
 installvendorhtml1dir=''
 installvendorhtml3dir=''
-installvendorlib=''
-installvendorman1dir=''
-installvendorman3dir=''
-installvendorscript=''
+installvendorlib='~INST_TOP~/lib/perl5/vendor_perl'
+installvendorman1dir='~INST_TOP~/man/man1'
+installvendorman3dir='~INST_TOP~/man/man3'
+installvendorscript='~INST_TOP~/bin'
 intsize='4'
 issymlink=''
 ivdformat='"ld"'
@@ -854,9 +852,9 @@ ivtype='long'
 known_extensions='~static_ext~ ~dynamic_ext~ ~nonxs_ext~'
 ksh=''
 ld='~ARCHPREFIX~g++'
-lddlflags='-mdll ~LINK_FLAGS~'
-ldflags='~LINK_FLAGS~'
-ldflags_uselargefiles=''
+lddlflags='-mdll ~LINK_FLAGS~ -L"~INST_TOP~\bin"'
+ldflags='~LINK_FLAGS~ -L"~INST_TOP~\bin"'
+ldflags_uselargefiles='-L"~INST_TOP~\bin"'
 ldlibpthname=''
 less='less'
 lib_ext='.a'
@@ -898,11 +896,11 @@ make_set_make='#'
 mallocobj='malloc.o'
 mallocsrc='malloc.c'
 malloctype='void *'
-man1dir='~INST_TOP~~INST_VER~\man\man1'
-man1direxp='~INST_TOP~~INST_VER~\man\man1'
+man1dir='~INST_TOP~/man/man1'
+man1direxp='~INST_TOP~/man/man1'
 man1ext='1'
-man3dir='~INST_TOP~~INST_VER~\man\man3'
-man3direxp='~INST_TOP~~INST_VER~\man\man3'
+man3dir='~INST_TOP~/man/man3'
+man3direxp='~INST_TOP~/man/man3'
 man3ext='3'
 mips_type=''
 mistrustnm=''
@@ -913,8 +911,8 @@ more='more /e'
 multiarch='undef'
 mv=''
 myarchname='MSWin32'
-mydomain=''
-myhostname=''
+mydomain='.conda'
+myhostname='conda'
 myuname=''
 n='-n'
 need_va_copy='undef'
@@ -945,7 +943,7 @@ optimize='-O2'
 orderlib='false'
 osname='MSWin32'
 osvers='4.0'
-otherlibdirs=''
+otherlibdirs='ph____________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________________ph'
 package='perl5'
 pager='more /e'
 passcat=''
@@ -955,9 +953,9 @@ perl5=''
 perl='perl'
 perl_patchlevel='~PERL_PATCHLEVEL~'
 perl_static_inline='static __inline__'
-perladmin=''
+perladmin='conda'
 perllibs='~libs~'
-perlpath='~INST_TOP~~INST_VER~\bin~INST_ARCH~\perl.exe'
+perlpath='~INST_TOP~/bin/perl.exe'
 pg=''
 phostname='hostname'
 pidtype='int'
@@ -966,8 +964,8 @@ pmake=''
 pr=''
 prefix='~INST_TOP~'
 prefixexp='~INST_TOP~'
-privlib='~INST_TOP~~INST_VER~\lib'
-privlibexp='~INST_TOP~~INST_VER~\lib'
+privlib='~INST_TOP~/lib/perl5/core_perl'
+privlibexp='~INST_TOP~/lib/perl5/core_perl'
 procselfexe=''
 prototype='define'
 ptrsize='4'
@@ -1005,8 +1003,8 @@ sPRIu64='"lu"'
 sPRIx64='"lx"'
 sSCNfldbl='"Lf"'
 sched_yield=''
-scriptdir='~INST_TOP~~INST_VER~\bin'
-scriptdirexp='~INST_TOP~~INST_VER~\bin'
+scriptdir='~INST_TOP~/bin'
+scriptdirexp='~INST_TOP~/bin'
 sed='sed'
 seedfunc='Perl_drand48_init'
 selectminbits='32'
@@ -1033,25 +1031,25 @@ sig_num='0 1 2 21 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 20
 sig_num_init='0, 1, 2, 21, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 20, 0'
 sig_size='27'
 signal_t='void'
-sitearch='~INST_TOP~\site~INST_VER~\lib~INST_ARCH~'
-sitearchexp='~INST_TOP~\site~INST_VER~\lib~INST_ARCH~'
-sitebin='~INST_TOP~\site~INST_VER~\bin~INST_ARCH~'
-sitebinexp='~INST_TOP~\site~INST_VER~\bin~INST_ARCH~'
+sitearch='~INST_TOP~/lib/perl5/~PKG_VERS~/site_perl'
+sitearchexp='~INST_TOP~/lib/perl5/~PKG_VERS~/site_perl'
+sitebin='~INST_TOP~/bin'
+sitebinexp='~INST_TOP~/bin'
 sitehtml1dir=''
 sitehtml1direxp=''
 sitehtml3dir=''
 sitehtml3direxp=''
-sitelib='~INST_TOP~\site~INST_VER~\lib'
+sitelib='~INST_TOP~/lib/perl5/site_perl'
 sitelib_stem=''
-sitelibexp='~INST_TOP~\site~INST_VER~\lib'
+sitelibexp='~INST_TOP~/lib/perl5/site_perl'
 siteman1dir=''
 siteman1direxp=''
 siteman3dir=''
 siteman3direxp=''
-siteprefix='~INST_TOP~\site~INST_VER~'
-siteprefixexp='~INST_TOP~\site~INST_VER~'
-sitescript=''
-sitescriptexp=''
+siteprefix='~INST_TOP~'
+siteprefixexp='~INST_TOP~'
+sitescript='~INST_TOP~/bin'
+sitescriptexp='~INST_TOP~/bin'
 sizesize='4'
 sizetype='size_t'
 sleep=''
@@ -1116,7 +1114,7 @@ uname='uname'
 uniq='uniq'
 uquadtype='unsigned long long'
 use5005threads='undef'
-use64bitall='undef'
+use64bitall='define'
 use64bitint='undef'
 usecbacktrace='undef'
 usecrosscompile='undef'
@@ -1144,7 +1142,7 @@ useshrplib='true'
 usesitecustomize='undef'
 usesocks='undef'
 usethreads='undef'
-usevendorprefix='undef'
+usevendorprefix='define'
 usevfork='false'
 usrinc='/usr/include'
 uuname=''
@@ -1154,25 +1152,25 @@ uvsize='4'
 uvtype='unsigned long'
 uvuformat='"lu"'
 uvxformat='"lx"'
-vendorarch=''
-vendorarchexp=''
-vendorbin=''
-vendorbinexp=''
+vendorarch='~INST_TOP~/lib/perl5/~PKG_VERS~/vendor_perl'
+vendorarchexp='~INST_TOP~/lib/perl5/~PKG_VERS~/vendor_perl'
+vendorbin='~INST_TOP~/bin'
+vendorbinexp='~INST_TOP~/bin'
 vendorhtml1dir=' '
 vendorhtml1direxp=''
 vendorhtml3dir=' '
 vendorhtml3direxp=''
-vendorlib=''
+vendorlib='~INST_TOP~/lib/perl5/vendor_perl'
 vendorlib_stem=''
-vendorlibexp=''
-vendorman1dir=' '
-vendorman1direxp=''
-vendorman3dir=' '
-vendorman3direxp=''
-vendorprefix=''
-vendorprefixexp=''
-vendorscript=''
-vendorscriptexp=''
+vendorlibexp='~INST_TOP~/lib/perl5/vendor_perl'
+vendorman1dir='~INST_TOP~/man/man1'
+vendorman1direxp='~INST_TOP~/man/man1'
+vendorman3dir='~INST_TOP~/man/man3'
+vendorman3direxp='~INST_TOP~/man/man3'
+vendorprefix='~INST_TOP~'
+vendorprefixexp='~INST_TOP~'
+vendorscript='~INST_TOP~/bin'
+vendorscriptexp='~INST_TOP~/bin'
 version=''
 version_patchlevel_string=''
 versiononly='undef'
-- 
2.43.0.windows.1

